<!doctype html>
<html lang="en">
<head>
    <title>Modal box - Accessibility workshop</title>
    <link rel="stylesheet" href="css/styles.css" media="all">
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(211, 211, 211, 0.4);
        }

        .modal-content {
            background-color: #ffffff;
            margin: 25% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;
        }
    </style>
</head>
<body>
    <main>
        <h1>Modal box</h1>
        <p class="notice">For the following exercise write pseudo code to enable closing of the modal box with the
            escape key, besides that use "document.activeElement" to store and restore the focus when opening and
            closing the modal</p>
        <section>
            <button class="open-modal">Register Now!</button>

            <div class="modal">
                <div class="modal-content">
                    <h1>Modal Form</h1>
                    <div>
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" name="firstName">
                    </div>
                    <div>
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" name="lastName">
                    </div>
                    <button id="closeModal">Submit</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        let focusedElementBeforeModal, modal, registerButton;
        let KEY = {
            ESCAPE: 27,
            TAB: 9
        };

        if (document.querySelector('.modal') && document.querySelector('.open-modal')) {
            modal = document.querySelector('.modal');
            registerButton = document.querySelector('.open-modal');
            registerButton.addEventListener('click', openModal);
        }

        function openModal() {
            focusedElementBeforeModal = document.activeElement;

            modal.style.display = 'block';
            modal.addEventListener('keydown', processEscapeTabKeys);

            let modalElements = 'input:not([disabled]), button:not([disabled])';
            let focusableElements = modal.querySelectorAll(modalElements);

            let firstElementOfModal = focusableElements[0];
            let lastElementOfModal = focusableElements[focusableElements.length - 1];

            firstElementOfModal.focus();

            function processEscapeTabKeys(event) {
                if (event.keyCode === KEY.TAB) {
                    if (document.activeElement === lastElementOfModal) {
                        event.preventDefault();
                        firstElementOfModal.focus();
                    }
                }
                if (event.keyCode === KEY.ESCAPE) {
                    modal.style.display = 'none';
                    focusedElementBeforeModal.focus();
                }
            }
        }
    </script>
</body>
</html>
